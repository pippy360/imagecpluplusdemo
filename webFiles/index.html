<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
      <style>
          .leftSidebar {
              width: 200px;
              float: left;
          }
          .middleImageContainer {
          }
          .rightSidebar {
              width: 200px;
              float: left;
          }

          .canvasInline {
              display: inline-block;
              position: absolute;
          }
          .selectUpperOptionsButtons {
              font-size: 13px;
              border: 0px;
              color: rgba(0,0,0, .7);
              cursor: pointer;
          }
          .upperOptionsButtons {
              /*color: #007bff;*/
              position: relative;
              top: 3px;
              cursor: pointer;
              font-size: 13px;
              float: right;
              background-color: rgba(255,255,255,0.0);
              color: rgba(0,0,0,.7);
              border: 0px;
              margin: 0px;
              padding: 0px;
          }
          .buttonsWrapper {
              display: flex;
              gap: 10px;
          }
          .buttonsWrapper label {
              display: block;
          }
          #databaseAndLookupCanvasWrapper:hover {
              box-sizing: border-box;
          }
          #databaseAndLookupCanvasWrapper:hover #lookupCanvas_ui {
              opacity: 1;
          }
          #databaseAndLookupCanvasWrapper #lookupCanvas_ui {
              opacity: 0;
          }
          #databaseAndLookupCanvasWrapper #lookupCanvas {
              opacity: 1;
          }
          #databaseAndLookupCanvasWrapper:hover #databaseCanvas_ui {
              opacity: 1;
          }
          #databaseAndLookupCanvasWrapper #databaseCanvas_ui {
              opacity: 0;
          }
          #databaseAndLookupCanvasWrapper #databaseCanvas {
              opacity: 1;
          }
          .innerLeftSide .canvasWrapperLeft {
              cursor: crosshair;
          }
          .canvasWrapper {
              border: 1px solid black;
          }
          .innerRightSide .canvasWrapperRight {
              cursor: crosshair;
          }
      </style>

    <title>Image matching</title>
    <style>
      body {
        font-family: arial;
        margin: 0;
        padding: none;
      }

      .emscripten { padding-right: 0; margin-left: auto; margin-right: auto; display: block; }
      div.emscripten { text-align: center; }
      div.emscripten_border { border: 1px solid black; }
      /* the canvas *must not* have any border or padding, or mouse coords will be wrong */
      canvas.emscripten { border: 0px none; background-color: black; }

      #emscripten_logo {
        display: inline-block;
        margin: 0;
      }

      .spinner {
        height: 30px;
        width: 30px;
        margin: 0;
        margin-top: 20px;
        margin-left: 20px;
        display: inline-block;
        vertical-align: top;

        -webkit-animation: rotation .8s linear infinite;
        -moz-animation: rotation .8s linear infinite;
        -o-animation: rotation .8s linear infinite;
        animation: rotation 0.8s linear infinite;

        border-left: 5px solid rgb(235, 235, 235);
        border-right: 5px solid rgb(235, 235, 235);
        border-bottom: 5px solid rgb(235, 235, 235);
        border-top: 5px solid rgb(120, 120, 120);

        border-radius: 100%;
        background-color: rgb(189, 215, 46);
      }

      @-webkit-keyframes rotation {
        from {-webkit-transform: rotate(0deg);}
        to {-webkit-transform: rotate(360deg);}
      }
      @-moz-keyframes rotation {
        from {-moz-transform: rotate(0deg);}
        to {-moz-transform: rotate(360deg);}
      }
      @-o-keyframes rotation {
        from {-o-transform: rotate(0deg);}
        to {-o-transform: rotate(360deg);}
      }
      @keyframes rotation {
        from {transform: rotate(0deg);}
        to {transform: rotate(360deg);}
      }

      #status {
        display: inline-block;
        vertical-align: top;
        margin-top: 30px;
        margin-left: 20px;
        font-weight: bold;
        color: rgb(120, 120, 120);
      }

      #progress {
        height: 20px;
        width: 300px;
      }

      #controls {
        display: inline-block;
        float: right;
        vertical-align: top;
        margin-top: 30px;
        margin-right: 20px;
      }

      #output {
        width: 100%;
        height: 200px;
        margin: 0 auto;
        margin-top: 10px;
        border-left: 0px;
        border-right: 0px;
        padding-left: 0px;
        padding-right: 0px;
        display: block;
        background-color: black;
        color: white;
        font-family: 'Lucida Console', Monaco, monospace;
        outline: none;
      }
      #shapelist2{
          display: inline-block;
          overflow: scroll;
          width: 100%;
      }
      .shapeListEl{
          border-bottom: 1px solid black;
          text-align: center;
          padding: 6px;
          cursor: pointer;
      }
      .shapeListEl:hover{
        opacity: .5;
      }
      .shapeListEl:hover{
          background-color: grey;
      }
      .carousel-inner .carousel-item {
          transition: -webkit-transform 0s ease;
          transition: transform 0s ease;
          transition: transform 0s ease, -webkit-transform 0s ease;
      }
      .imgThumbForSelection {
          width: 80px;
          height: 80px;
      }
      #clickandseeImageLeft_ui {
          cursor: crosshair;
      }
      #clickandseeImageRight_ui {
          cursor: crosshair;
      }
      .avoid-clicks {
          pointer-events: none;
      }
      .transformOpGroup {
          height: 33px;
          font-size: 13px;
      }
      .transformOpGroup .btn{
          font-size: 13px;
      }
      .transformOp {
          padding-top: 4px;
          padding-bottom: 4px;
          padding-bottom: 4px;
          background-color: #f9f9f9;
          border: 1px solid #666;
          color: rgba(0,0,0,.7);
      }
      .bottomRowCanvasHeightWidthWrapper {
          width: 202px;
          height: 202px;
      }
      .bottomRowCanvasHeightWidth {
          width: 200px;
          height: 200px;
      }
    </style>
  </head>
  <body class="container">
    <div style="display: flex">
        <div class="topPageDemoContainer clearfix" style="display: grid; grid-template-columns: 1fr 1fr; grid-column-gap: 10px">
            <div class="middleImageContainer">
                <div style="display: grid; justify-items: center">
                    <div class="buttonsWrapper" style="display: flex">
                        <div style="" class="transformOpGroup btn-group btn-group-toggle" data-toggle="buttons">
                            <label class="btn  btn-secondary transformOp active" onclick="setCurrnetOperation(enum_TransformationOperation.TRANSLATE)">
                                <input type="radio" name="options" autocomplete="off" checked="">Pan
                            </label>
                            <label class="btn btn-secondary transformOp" onclick="setCurrnetOperation(enum_TransformationOperation.UNIFORM_SCALE)">
                                <input type="radio" name="options" autocomplete="off">Zoom
                            </label>
                            <label class="btn btn-secondary transformOp" onclick="setCurrnetOperation(enum_TransformationOperation.NON_UNIFORM_SCALE)">
                                <input type="radio" name="options" autocomplete="off">Stretch
                            </label>
                            <label class="btn btn-secondary transformOp" onclick="setCurrnetOperation(enum_TransformationOperation.ROTATE)">
                                <input type="radio" name="options" autocomplete="off">Rotate
                            </label>
                            <label class="btn btn-secondary transformOp" onclick="setCurrnetOperation(enum_TransformationOperation.CROP)">
                                <input type="radio" name="options" autocomplete="off" >Crop
                            </label>
                            <label class="btn btn-secondary transformOp" onclick="setMode(enum_modes.inspect)">
                                <input type="radio" name="options" autocomplete="off" >Inspect
                            </label>
                        </div>
                        <!--            FIXME: we can remove this button once we add example matches...-->
                        <button type="button" style="margin-bottom: 8px;" class="transformOpGroup alert-danger btn btn-secondary" onclick="setDefaultTransformationValues()">Reset</button>

                    </div>
                </div>
                <div style="display: grid; grid-row-gap: 20px;">
                    <div id="databaseAndLookupCanvasWrapper" style="display: grid; grid-template-columns: 1fr 1fr; column-gap: 20px;" class="clearfix">
                        <div class="innerLeftSide">
                            <div>
                                <select class="selectUpperOptionsButtons" onchange="g_mainGlobalState.drawingImageLookup = parseInt(this.selectedOptions[0].value); draw();" style="">
                                    <option value="0" selected>Original Image</option>
                                    <option value="2">All Shape</option>
                                    <option value="3">Contours</option>
                                </select>
                                <span class="dropdown">
                                    <div class="upperOptionsButtons" type="button" id="dropdownMenuButton2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        + Add layer
                                    </div>
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton2">
                                        <div style="padding: 10px; width: 270px">
                                            <span>
                                                <img src="images/205488737.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/41mYED6GE6L._AC_.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/4216447_1.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/accidental-wes-anderson-montreal.webp" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/brockton-point-lighthouse-in-stanley-park.webp" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/il_1588xN.3197638522_lo52.webp" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/il_fullxfull.1219881601_lkvp.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/basicshapes.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/IMG_20191024_130833.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/richandmalty.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/richandmalty400px.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/Total_Rickall.webp" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/googlelogo.webp" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/font.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/forest.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/tech.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/mus.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/boo.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/cat01.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/head.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/image.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/image8-2.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/mouse.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/pasted again.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/pasted again01.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/pasted image 0.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/soup.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/soup02.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/soup03.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/spirited01.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/spirited02.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/spirited03.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/spirited04.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/spirited05.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/spirited06.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/spirited07.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/spirited08.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/spirited_01.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/spirited_away.jpg" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/Total_Rickall.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/mus.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/mus.png" onclick="addLayerToLookupCanvas(this.src)" class="imgThumbForSelection">
                                            </span>

                                        </div>
                                    </div>
                                </span>
                            </div>

                            <div class="canvasWrapper">
                                <div class="canvasWrapperLeft clearfix" style="width: 400px; height: 400px;">
                                    <canvas id="lookupCanvas" class="canvasInline" width="400" height="400"></canvas>
                                    <canvas id="lookupCanvas_uilower" class="canvasInline canvasUILayer" width="400" height="400"></canvas>
                                    <canvas id="lookupCanvas_ui" class="canvasInline canvasUILayer" width="400" height="400"></canvas>
                                    <canvas id="lookupCanvas_uipass" class="canvasInline canvasUILayer avoid-clicks" width="400" height="400"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="innerRightSide">
                            <div>
                                <select class="selectUpperOptionsButtons" onchange="g_mainGlobalState.drawingImageDatabase = parseInt(this.selectedOptions[0].value); draw()" style="">
                                    <option value="0" selected>Original Image</option>
                                    <option value="2">All Shape</option>
                                    <option value="3">Contours</option>
                                </select>
                                <span class="dropdown">
                                    <button class="upperOptionsButtons" type="button" id="dropdownMenuButton3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        + Add layer
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton3">
                                        <div style="padding: 10px; width: 270px">
                                            <span>
                                                <img src="images/basicshapes.png" onclick="addLayerToDatabaseCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                                <span>
                                                <img src="images/IMG_20191024_130833.jpg" onclick="addLayerToDatabaseCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                                <span>
                                                <img src="images/richandmalty.jpg" onclick="addLayerToDatabaseCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                                <span>
                                                <img src="images/richandmalty400px.png" onclick="addLayerToDatabaseCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                                <span>
                                                <img src="images/Total_Rickall.webp" onclick="addLayerToDatabaseCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                                <span>
                                                <img src="images/googlelogo.webp" onclick="addLayerToDatabaseCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                                <span>
                                                <img src="images/font.jpg" onclick="addLayerToDatabaseCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/forest.jpg" onclick="addLayerToDatabaseCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/tech.png" onclick="addLayerToDatabaseCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                            <span>
                                                <img src="images/mus.png" onclick="addLayerToDatabaseCanvas(this.src)" class="imgThumbForSelection">
                                            </span>
                                        </div>
                                    </div>
                                </span>
                            </div>
                            <div class="canvasWrapper">
                                <div class="canvasWrapperRight" style="width: 400px; height: 400px;">
                                    <canvas id="databaseCanvas" class="canvasInline" width="400" height="400"></canvas>
                                    <canvas id="databaseCanvas_uilower" class="canvasInline canvasUILayer" width="400" height="400"></canvas>
                                    <canvas id="databaseCanvas_ui" class="canvasInline canvasUILayer" width="400" height="400"></canvas>
                                    <canvas id="databaseCanvas_uipass" class="canvasInline canvasUILayer avoid-clicks" width="400" height="400"></canvas>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="bottomRow" style="display: flex; justify-content: center ">
                        <div id="clickandseeListLeft" style="width: 70px; height: 200px; overflow: auto;">
                            <pre></pre>
                        </div>
                        <div class="canvasWrapper bottomRowCanvasHeightWidthWrapper" style="" >
                            <canvas id="lookupCanvasFrag" class="canvasInline bottomRowCanvasHeightWidth" width="256" height="256"></canvas>
                            <canvas id="lookupCanvasFrag_ui" class="canvasInline canvasUILayer bottomRowCanvasHeightWidth" width="256" height="256"></canvas>
                        </div>
                        <div id="hammingDistanceForResult" style="width: 100px; padding: 20px; text-align: center; font-size: 14px"></div>
                        <div style="">
                            <div class="canvasWrapper bottomRowCanvasHeightWidthWrapper" style="">
                                <canvas id="databaseCanvasFrag" class="canvasInline bottomRowCanvasHeightWidth" width="256" height="256"></canvas>
                                <canvas id="databaseCanvasFrag_ui" class="canvasInline canvasUILayer bottomRowCanvasHeightWidth" width="256" height="256"></canvas>
                            </div>
                            <div id="rotationSliderWrapper" style="display: none; padding: 10px 40px">
                                <div style="text-align: center">Rotation</div>
                                <input style="width: 100%; padding: 4px" type="range" min="0" max="720" id="clickandseeRotation" oninput="drawshapefromClickandseeRight(g_lastusedClickAndSeeShapeRight, 0)" value="360">
                            </div>
                        </div>
                        <div id="clickandseeListRight" style="width: 70px; height: 200px; overflow: auto; float: left">
                            <pre></pre>
                        </div>
                    </div>
                </div>
            </div>
            <div class="rightSidebar">
                <div style="padding-top: 46px; text-align: center; font-size: 13px; color: rgba(0,0,0,.7)">Matches</div>
                <div id="shapelist2" style="height: 400px; overflow: auto">
                    <pre>shape list goes here...</pre>
                </div>
            </div>
        </div>


    </div>

  </body>

  <!--some temporary canvases we use for drawing-->
  <canvas id="lookupCanvas_output"    style="display: none" class="canvasInline" width="400" height="400"></canvas>
  <canvas id="databaseCanvas_output"  style="display: none" class="canvasInline" width="400" height="400"></canvas>
  <canvas id="lookupCanvas2"          style="display: none" class="canvasInline" width="400" height="400"></canvas>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->

  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  <script src="scripts/math.min.js"></script>
  <script src="scripts/matrixMaths.js"></script>
  <script src="scripts/common.js"></script>
  <script src="scripts/drawWrappers.js"></script>
  <script src="scripts/matrixMaths.js"></script>
  <script src="scripts/polygonFuncs.js"></script>
  <script src="scripts/transformOperations.js"></script>

  <script type='text/javascript'>

      function debug_toImageShape() {
          const matinv = math.inv(g_transformState.activeCanvas.layers[g_transformState.activeCanvas.layers.length-1].appliedTransformationsMat);
          const shape = applyTransformationMatrixToAllPoints(shapeStrToShape(g_lastusedClickAndSeeShapeLeft), matinv);
          let str = "[";
          for (let i = 0; i < shape.length; i++) {
              if (i > 0)
                  str += ", "
              str += "[" + shape[i][0] + ", " + shape[i][1] + "]"
          }
          str += "]";
          console.log("The output:");
          return str;
      }


      let api;
      let module;
      var statusElement = document.getElementById('status');
      var progressElement = document.getElementById('progress');
      var spinnerElement = document.getElementById('spinner');

      var Module = {
          preRun: [],
          postRun: [],
          print: (function() {
              return function(text) {
                  if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
                  // These replacements are necessary if you render to raw HTML
                  //text = text.replace(/&/g, "&amp;");
                  //text = text.replace(/</g, "&lt;");
                  //text = text.replace(/>/g, "&gt;");
                  //text = text.replace('\n', '<br>', 'g');
                  console.log(text);
              };
          })(),
          printErr: function(text) {
              if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
              console.error(text);
          },
          canvas: (function() {
              return null;
          })(),
          setStatus: function(text) {
              if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
              if (text === Module.setStatus.last.text) return;
              var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
              var now = Date.now();
              if (m && now - Module.setStatus.last.time < 30) return; // if this is a progress update, skip it if too soon
              Module.setStatus.last.time = now;
              Module.setStatus.last.text = text;
          },
          totalDependencies: 0,
          monitorRunDependencies: function(left) {
              this.totalDependencies = Math.max(this.totalDependencies, left);
              Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
          }
      };
      Module.setStatus('Downloading...');

  </script>
  <script async type="text/javascript" src="wasmLibs/cppdemo.js"></script>
  <script src="scripts/main.js" ></script>
  <script>

      //The ptr to the wasm memory that should contain our lookup canvas data
      let lookup_canvas_wasm_heap;

      //The ptr to the wasm memory that should contain our "already in the database" canvas data
      let canvas_inserted_in_database_wasm_heap;

      Module.onRuntimeInitialized = async _ => {
          module = Module;

          const lookupCanvas = document.getElementById('lookupCanvas');

          lookup_canvas_wasm_heap = {
              ptr: module._malloc(lookupCanvas.width * lookupCanvas.height * 4),
              width: lookupCanvas.width,
              height: lookupCanvas.height
          };

          const databaseCanvas = document.getElementById('databaseCanvas');

          canvas_inserted_in_database_wasm_heap = {
              ptr: module._malloc(databaseCanvas.width * databaseCanvas.height * 4),
              width: databaseCanvas.width,
              height: databaseCanvas.height
          };

          api = {
              create_buffer: Module.create_buffer,
          };

          main();
      };

  </script>
</html>


